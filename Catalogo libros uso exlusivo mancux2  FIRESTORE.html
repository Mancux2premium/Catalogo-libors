<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <link rel="shortcut icon" href="img/logo.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cat√°logo de Cuadernillos</title>
    
    <style>
        /* Tu CSS original va aqu√≠, no necesita cambios */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f4f4f4;
            color: #333;
        }
        .container {
            max-width: 1200px;
            margin: auto;
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        h1, h2 {
            text-align: center;
            color: #444;
        }
        .search-container {
	        height: 20px;
            text-align: center;
            margin-bottom: 20px;
 	
        }
        #search-input {
            padding: 10px;
            width: 70%;
            max-width: 400px;
            border-radius: 5px;
            border: 1px solid #ddd;
        }
        .catalog {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }
        .book {
            background: #fff;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            text-align: center;
            width: 250px;
            transition: transform 0.2s;
        }
        .book:hover {
            transform: translateY(-5px);
        }
        .book-img {
            width: 150px;
            height: 200px;
            object-fit: cover;
            border-radius: 4px;
            margin-bottom: 10px;
            transition: 0.5s;
        }
        .book-img.bw-filter {
            filter: grayscale(100%);
        }
        .book-img:hover {
            filter: grayscale(0%);
        }
        .book-title {
            font-size: 1.2em;
            font-weight: bold;
            margin: 10px 0;
        }
        .book-pages {
            font-size: 0.9em;
            color: #777;
            margin-bottom: 10px;
        }
        .book-price {
            color: #007bff;
            font-size: 1.1em;
            margin: 10px 0;
        }
        .book-format {
            margin-bottom: 10px;
        }
        .book-format label, .book-binding label {
            font-size: 0.9em;
            cursor: pointer;
        }
        .book-binding {
            margin: 15px 0;
        }
        .add-to-cart-btn {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin-top: 10px;
            cursor: pointer;
            border-radius: 5px;
            transition: background-color 0.3s;
        }
        .add-to-cart-btn:hover {
            background-color: #0056b3;
        }
        .cart-section, .stats-section {
            margin-top: 40px;
            border-top: 2px solid #ddd;
            padding-top: 20px;
        }
        #cart-items {
            list-style: none;
            padding: 0;
        }
        #cart-items li {
            background: #f9f9f9;
            padding: 10px;
            margin-bottom: 8px;
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .remove-btn {
            background-color: #dc3545;
            color: white;
            border: none;
            padding: 5px 10px;
            cursor: pointer;
            border-radius: 3px;
        }
        #cart-total {
            font-size: 1.2em;
            font-weight: bold;
            text-align: right;
            margin-top: 10px;
            line-height: 1.5;
        }
        .payment-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 20px;
        }
        .payment-button {
            border: none;
            padding: 15px 30px;
            font-size: 1.1em;
            cursor: pointer;
            border-radius: 5px;
            display: block;
            width: 100%;
            text-align: center;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: background-color 0.3s;
        }
        .payment-button img {
            height: 25px;
        }
        #checkout-mp-button {
            background-color: #00aee4;
            color: white;
        }
        #checkout-mp-button:hover {
            background-color: #008eb3;
        }
        #checkout-wa-button {
            background-color: #25D366;
            color: white;
        }
        #checkout-wa-button:hover {
            background-color: #128C7E;
        }
        #confirm-sale-btn {
            background-color: #28a745;
            color: white;
        }
        #confirm-sale-btn:hover {
            background-color: #218838;
        }
        #toggle-theme-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            background-color: #007bff;
            color: white;
            font-weight: bold;
            transition: background-color 0.3s;
        }
        #toggle-theme-btn:hover {
            background-color: #0056b3;
        }
        body.dark-mode {
            background-color: #121212;
            color: #e0e0e0;
        }
        body.dark-mode .container {
            background: #1e1e1e;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.1);
        }
        body.dark-mode h1, body.dark-mode h2 {
            color: #bb86fc;
        }
        body.dark-mode #search-input {
            background-color: #2c2c2c;
            color: #e0e0e0;
            border-color: #555;
        }
        body.dark-mode .book {
            background: #2c2c2c;
            box-shadow: 0 2px 5px rgba(255, 255, 255, 0.1);
        }
        body.dark-mode .book-pages {
            color: #b0b0b0;
        }
        body.dark-mode .book-price {
            color: #89c4ff;
        }
        body.dark-mode .cart-section, body.dark-mode .stats-section {
            border-top: 2px solid #555;
        }
        body.dark-mode #cart-items li {
            background: #2c2c2c;
        }
        body.dark-mode #cart-total span {
            color: #b0b0b0 !important;
        }
        body.dark-mode .remove-btn {
            background-color: #cf6679;
        }
        body.dark-mode #checkout-mp-button {
            background-color: #03dac6;
        }
        body.dark-mode #checkout-mp-button:hover {
            background-color: #018786;
        }
        body.dark-mode #checkout-wa-button {
            background-color: #4CAF50;
        }
        body.dark-mode #checkout-wa-button:hover {
            background-color: #388e3c;
        }
         body.dark-mode #confirm-sale-btn {
            background-color: #4CAF50;
        }
        body.dark-mode #confirm-sale-btn:hover {
            background-color: #388e3c;
        }
  
        #mp-details-container {
            margin-top: 20px;
            padding: 15px;
            border: 1px dashed #00aee4;
            border-radius: 5px;
            background-color: #e6f7ff;
            color: #007bff;
            display: none;
        }
        #mp-details-container p {
            margin: 5px 0;
        }
        body.dark-mode #mp-details-container {
            background-color: #2c2c2c;
            color: #bb86fc;
            border-color: #bb86fc;
        }
        #back-to-top-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: none;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            transition: opacity 0.3s;
        }
        #back-to-top-btn:hover {
            opacity: 0.8;
        }
        #notification {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #28a745;
            color: white;
            padding: 15px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            z-index: 1000;
            visibility: hidden;
            opacity: 0;
            transition: opacity 0.5s, visibility 0.5s;
        }
        #notification.show {
            visibility: visible;
            opacity: 1;
        }
        body.dark-mode #notification {
            background-color: #03dac6;
            color: #121212;
        }
        .stats-filter {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap; /* Para mejor adaptabilidad */
        }
        .stats-filter label {
            margin-right: 5px;
        }
        #stats-year-filter, #stats-month-filter {
            padding: 8px;
            border-radius: 5px;
            border: 1px solid #ddd;
        }
        #toggle-stats-btn {
            display: block;
            width: 100%;
            padding: 10px;
            background-color: #6c757d;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        #stats-container {
            background-color: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 15px;
            margin-top: 10px;
        }
        #stats-container ol {
            padding-left: 20px;
        }
        body.dark-mode #stats-container {
            background-color: #2c2c2c;
            border-color: #555;
        }
        body.dark-mode #stats-year-filter, body.dark-mode #stats-month-filter {
            background-color: #2c2c2c;
            color: #e0e0e0;
            border-color: #555;
        }
    </style>
</head>
<body>

<div id="notification"></div>

<div class="container">
 	<button id="toggle-theme-btn">Modo Oscuro</button>
    <h1>üìö Cuadernillos üìö</h1>
    <div class="search-container">
        <input type="text" id="search-input" placeholder="Buscar libro...">
    </div>
    <hr>
    <h2>Cat√°logo</h2>
    <div class="catalog"></div>
<hr>
    <div class="cart-section">
        <h2>üõí Carrito de Compras</h2>
        <ul id="cart-items"></ul>
        <p id="cart-total">Total: $0.00</p>
        <div class="payment-options">
           <button id="checkout-mp-button" class="payment-button">
                <img src="https://http2.mlstatic.com/frontend-assets/ui-navigation/5.32.1/mercadopago/logo__small.png" alt="Mercado Pago Logo">
                Datos de Mercado Pago
            </button>
            <button id="checkout-wa-button" class="payment-button">
                <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" alt="WhatsApp Logo">
                Enviar mensaje a WhatsApp
            </button>
            <button id="confirm-sale-btn" class="payment-button">‚úÖ Confirmar Venta</button>
        </div>
        <div id="mp-details-container"></div>
    </div>
    <div class="stats-section">
        <h2>üìä Estad√≠sticas de Ventas</h2>
        <div class="stats-filter">
            <label for="stats-year-filter">A√±o:</label>
            <select id="stats-year-filter"></select>
            <label for="stats-month-filter">Mes:</label>
            <select id="stats-month-filter"></select>
        </div>
        <button id="toggle-stats-btn">Mostrar Estad√≠sticas</button>
        <div id="stats-container" style="display: none;">
        </div>
    </div>
</div>
<button id="back-to-top-btn" title="Volver arriba">‚ñ≤</button>
<script type="module">
    // --- INICIO: CORRECCI√ìN FIREBASE ---

    // 1. Importar todo lo necesario de los SDK de Firebase
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
    import { getFirestore, collection, getDocs, query, where, writeBatch, doc, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js";

    // Tu objeto de configuraci√≥n de Firebase
    const firebaseConfig = {
        apiKey: "AIzaSyChmNB67ndoaPgfYjmyjNH4kvelnjfOKA0",
        authDomain: "cuadernillos-f9d68.firebaseapp.com",
        projectId: "cuadernillos-f9d68",
        storageBucket: "cuadernillos-f9d68.appspot.com",
        messagingSenderId: "146570697003",
        appId: "1:146570697003:web:8af18fca2e127c6d34cd6e",
        measurementId: "G-WYR4V1CNZV"
    };

    // 2. Inicializar Firebase App y Firestore
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app); // ¬°Esta l√≠nea es la que faltaba y causaba el error!

    // --- FIN: CORRECCI√ìN FIREBASE ---

    const booksData = [
{ title: "Una vendetta", pages:2, priceAnillado: 2000, color:false, imgSrc: "img/vendetta.bmp", displayPages:4 },
{ title: "Patron", pages:5, priceAnillado: 2000, color:false, imgSrc: "img/patron.bmp", displayPages:10 },
{ title: "El gato negro", pages:3, priceAnillado: 2000, color:false, imgSrc: "img/gatonegro.bmp", displayPages:6 },
{ title: "La gallina degollada", pages:6, priceAnillado: 2000, color:false, imgSrc: "img/gallina.bmp", displayPages:12 },
{ title: "La unica moneda", pages:4, priceAnillado: 2000, color:false, imgSrc: "img/launicamoneda.bmp", displayPages:7 },
{ title: "El baldio", pages:1, priceAnillado: 2000, color:false, imgSrc: "img/elbaldio.bmp", displayPages:2 },
{ title: "El marica", pages:6, priceAnillado: 2000, color:false, imgSrc: "img/marica.bmp", displayPages:12 },
{ title: "En puntas de pie", pages:5, priceAnillado: 2000, color:false, imgSrc: "img/Enpuntasde pie.JPG", displayPages:9 },
	{ title: "Minotauro en zapatillas", pages:33, priceAnillado: 2000, color:false, imgSrc: "img/minotauroenzapatillas.jpg", displayPages:67 },
	{ title: "Cronica de una muerte anunciada", pages:31, priceAnillado: 2000, color:false, imgSrc: "img/cronicade unamuerte.JPG", displayPages:62 },
	{ title: "Dos miserables besos", pages:28, priceAnillado: 2000, color:false, imgSrc: "img/dosmiserablesbesosporada.png", displayPages:56 },
	{ title: "La Dama del Alba", pages:33, priceAnillado: 2000, color:false, imgSrc: "img/ladamadelalba.png", displayPages:66 },
	{ title: "Los Cuatro acuerdos", pages:33, priceAnillado: 2000, color:false, imgSrc: "img/los4acuertdos.png", displayPages:66 },
	{ title: "Martin Fierro y La vuelta del Martin Fierro (Apaisado)", pages:66, priceAnillado: 2000, color:false, imgSrc: "img/martinFierroylavueltadelmartinfierro.bmp", displayPages: 264},
	{ title: "Martin Fierro y  La vuelta del Martin Fierro (Doble faz)",pages:132, priceAnillado: 2000, color:false, imgSrc: "img/martinFierroylavueltadelmartinfierro.bmp", displayPages:264 },
	{ title: "Martin Fierro (Apaisado)", pages:28, priceAnillado: 2000, color:false, imgSrc: "img/martinFierro.bmp", displayPages:111 },
	{ title: "Martin Fierro (Doble faz)", pages:56, priceAnillado: 2000, color:false, imgSrc: "img/martinFierro.bmp", displayPages:111 },
	{ title: "La telara√±a de carlota (apaisado)", pages:40, priceAnillado: 2000, color:true, imgSrc: "img/latelara√±adecarlota.bmp", displayPages:158 },
	{ title: "La telara√±a de carlota (Doble faz)", pages:79, priceAnillado: 2000, color:true, imgSrc: "img/latelara√±adecarlota.bmp", displayPages:158 },
	{ title: "Alicia en el pais de las maravillas", pages:40, priceAnillado: 2000, color:false, imgSrc: "img/aliciapaismaravilla.bmp", displayPages:80 },
	{ title: "Laberintos tres mitos griegos", pages:12, priceAnillado: 2000, color:true, imgSrc: "img/Laberintostresmitorsgriegos.bmp", displayPages:23 },
	{ title: "Las aventuras de Pinocho (Carlos collodi)", pages:34, priceAnillado: 2000, color:false, imgSrc: "img/Las aventuras de Pinocho.bmp", displayPages:68 },
{ title: "El gato con botas (continuemos estudianto)", pages:4, priceAnillado: 2000, color:false, imgSrc: "img/elgatoconbocascontinuamosestudiando.bmp", displayPages:8 },
{ title: "El tren especial expreso desaparecido (Apaisado)", pages:16, priceAnillado: 2000, color:true, imgSrc: "img/eltrenespecialexpresodesaparecido.bmp", displayPages:64 },
{ title: "El tren especial expreso desaparecido ", pages:32, priceAnillado: 2000, color:true, imgSrc: "img/eltrenespecialexpresodesaparecido.bmp", displayPages:64 },
{ title: "Hansel y Gretel continuamos estudianto", pages:6, priceAnillado: 2000, color:true, imgSrc: "img/hansel y gretel .bmp", displayPages:12 },
{ title: "La adoracion en el apocalipsis", pages:61, priceAnillado: 2000, color:false, imgSrc: "img/laadoracionenelapocalipsis.bmp", displayPages:122 },
{ title: "Biologia 3 Santillana", pages:80, priceAnillado: 2000, color:true, imgSrc: "img/biologia 3 santillana.bmp", displayPages:160 },
{ title: "Socorro", pages:43, priceAnillado: 2000, color:false, imgSrc: "img/socorro.bmp", displayPages:85 },
{ title: "Escuela de Discipulado para nuevos creyentes ABC", pages:54, priceAnillado: 2000, color:false, imgSrc: "img/ESCUELA DE DISCIPULADO PARA NUEVOS CREYENTES.bmp", displayPages:108 },
{ title: "Rebelion en la granja", pages:32, priceAnillado: 2000, color:false, imgSrc: "img/rebelion en lagranja.bmp", displayPages:64 },
{ title: "Intermitente Rafaela Mariana Furiasse", pages:56, priceAnillado: 2000, color:false, imgSrc: "img/intermitente rafaela.JPG", displayPages:112 },
{ title: "Rafaela Mariana Furiasse", pages: 31, priceAnillado: 2000, color:false, imgSrc: "img/Rafaela Mariana Furiasse.bmp", displayPages:62 },
{ title: "Filosofia un espacio de pensamiento (Apaisado)", pages: 60, priceAnillado: 2000, color:false, imgSrc: "img/portada Filosofia 6.bmp", displayPages:238 },
{ title: "Filosofia un espacio de pensamiento Doble faz", pages: 119, priceAnillado: 2000, color:false, imgSrc: "img/portada Filosofia 6.bmp", displayPages:238 },
{ title: "Historia 4 Santillana", pages: 126, priceAnillado: 2000, color:true, imgSrc: "img/HISTORIA 4 SANTILLANA.JPG", displayPages:252 },
{ title: "Koi ", pages: 30, priceAnillado: 2000, color: false, imgSrc: "img/koi.bmp", displayPages:60 },
{ title: "Lengua y literatura 2 Mandioca ", pages: 147, priceAnillado: 2000, color: true, imgSrc: "img/lenguayliteratura2mandioca.bmp", displayPages:294 },
{ title: "Own It students book ", pages: 71, priceAnillado: 2000, color: true, imgSrc: "img/Own It students book.bmp", displayPages: 141 },
{ title: "Own It workbook ", pages: 56, priceAnillado: 2000, color: false, imgSrc: "img/own it workbook.bmp", displayPages: 112 },
{ title: "Naturales 1 Santillana ", pages: 107, priceAnillado: 2000, color: true, imgSrc: "img/portada naturales 1.bmp", displayPages: 214 },
{ title: "Los vecinos mueren en las novelas ", pages: 38, priceAnillado: 2000, color: false, imgSrc: "img/losvecinosmuerenenlanovelas.bmp", displayPages: 76 },
{ title: "Caro dice", pages: 60, priceAnillado: 2000, color: false, imgSrc: "img/Caro dice.bmp", displayPages: 238 },
    { title: "El Hilo se corta por lo mas delgado", pages: 6, priceAnillado: 2000, color: true, imgSrc: "img/elhilosecortaporlomasdelgado.bmp", displayPages: 11 },
   { title: "Sociales 1 Santillana", pages: 124, priceAnillado: 2000, color: true, imgSrc: "img/sociales 1 santillana.JPG", displayPages: 248 },
   { title: "Geografia 3 Puerto Palos", pages: 117, priceAnillado: 2000, color: true, imgSrc: "img/geografia 3 puerto palos.png", displayPages: 233 },
   { title: "Geografia 3 Huellas Estrada", pages: 121, priceAnillado: 2000, color: true, imgSrc: "img/Portada geografia 3¬∞ huellas.PNG", displayPages: 242 },
    { title: "Nicanor y la luna", pages: 30, priceAnillado: 2000, color: false, imgSrc: "img/Nicanor y la luna.png", displayPages: 60 },
    { title: "NTICx Doble faz", pages: 137, priceAnillado: 2000, color: false, imgSrc: "img/ntick portada.PNG", displayPages: 274 },
    { title: "Aventuras y desventuras de Casiperro del hambre (Apaisado)", pages: 32, priceAnillado: 2000, color: false, imgSrc: "img/AVENTURAS Y DESVENTURAS DE CASI PERRO DEL HAMBRE.webp", displayPages: 128 },
    { title: "NTICx (Apaisado)", pages: 69, priceAnillado: 2000, color: false, imgSrc: "img/ntick portada.PNG", displayPages: 274 },
    { title: "Trabajo y ciudadania Maipue Doble faz", pages: 71, priceAnillado: 2000, color: false, imgSrc: "img/Trabajo y ciudadania portada.jpg", displayPages: 142 },
    { title: "Trabajo y ciudadania Maipue (Apaisado)", pages: 36, priceAnillado: 2000, color: false, imgSrc: "img/Trabajo y ciudadania portada.jpg", displayPages: 142 },
    { title: "Geografia 2 Santillana", pages: 104, priceAnillado: 2000, color: true, imgSrc: "img/tapa geografia.PNG", displayPages: 208 },
    { title: "Fisica y quimica 2 sm", pages: 99, priceAnillado: 2000, color: true, imgSrc: "img/Fisica quimica 2.PNG", displayPages: 198 },
    { title: "Fisica y quimica 3 sm", pages: 100, priceAnillado: 2000, color: true, imgSrc: "img/Fisica quimica 3¬∞.PNG", displayPages: 200 },
    { title: "Historia 3 Estrada", pages: 120, priceAnillado: 2000, color: true, imgSrc: "img/Historia 3¬∞ estrada.PNG", displayPages: 240 },
    { title: "La tercera palabra", pages: 29, priceAnillado: 2000, color: false, imgSrc: "img/La Tercera Palabra.JPG", displayPages: 58 },
    { title: "La isla del tesoro (Doble faz)", pages: 49, priceAnillado: 2000, color: false, imgSrc: "img/La isla del tesoro.png", displayPages: 98 },
      { title: "La isla del tesoro (Apaisado)", pages: 25, priceAnillado: 2000, color: false, imgSrc: "img/La isla del tesoro.png", displayPages: 98 },
    { title: "El espejo africano", pages: 34, priceAnillado: 2000, color: false, imgSrc: "img/Elespejoafricano.JPG", displayPages: 68 },
    { title: "Mi Planta de Naranja lima ", pages: 48, priceAnillado: 2000, color: false, imgSrc: "img/Mi planta de naranja lima portada 2025.png", displayPages: 96 },
    { title: "El eternauta", pages: 89, priceAnillado: 2000, color: false, imgSrc: "img/El eternauta portada.png", displayPages: 353 },
    { title: "De como Romeo se tranzo a Julieta", pages: 28, priceAnillado: 2000, color: false, imgSrc: "img/de como romeo se tranzo a julieta portada.bmp", displayPages: 112 },
    { title: "Mitos clasificados 1", pages: 45, priceAnillado: 2000, color: false, imgSrc: "img/mitos clasificados 1 portada.JPG", displayPages: 90 },
    { title: "Prohibido suicidarse en primavera", pages: 28, priceAnillado: 2000, color: false, imgSrc: "img/prohibido suicidarse en primavera portada.JPG", displayPages: 56 },
    { title: "La entrevista", pages: 43, priceAnillado: 2000, color: false, imgSrc: "img/La entrevista portada.JPG", displayPages: 86 },
    { title: "Boda de sangre", pages: 19, priceAnillado: 2000, color: false, imgSrc: "img/boda de sangre portada.JPG", displayPages: 37 },
    { title: "Amigos por el viento", pages: 19, priceAnillado: 2000, color: false, imgSrc: "img/amigos por el viento.png", displayPages: 38 },
    { title: "Ceremonia secreta", pages: 29, priceAnillado: 2000, color: false, imgSrc: "img/ceremonia secreta.JPG", displayPages: 57 },
    { title: "Casa de mu√±ecas", pages: 54, priceAnillado: 2000, color: false, imgSrc: "img/casa de mu√±ecas.JPG", displayPages: 108 },
    { title: "La casa de Bernarda Alba", pages: 25, priceAnillado: 2000, color: false, imgSrc: "img/La casa de bernarda alba 2025.png", displayPages: 50 },
    { title: "La incre√≠ble y triste historia de la c√°ndida Er√©ndida y su abuela desalmada", pages: 18, priceAnillado: 2000, color: false, imgSrc: "img/La incre√≠ble y triste historia de la c√°ndida Er√©ndida  y su abuela desalmada.JPG", displayPages: 36 },
    { title: "Historia 3 Mandioca", pages: 119, priceAnillado: 2000, color: true, imgSrc: "img/Historia 3 Mandioca.PNG", displayPages: 238 },
    { title: "Historia 3 Santillana", pages: 118, priceAnillado: 2000, color: true, imgSrc: "img/HISTORIA 3 SANTILLANA.JPG", displayPages: 236 },
    { title: "Buscando a mister i la amistad vence al bullyin", pages: 48, priceAnillado: 2000, color: false, imgSrc: "img/Buscando a mister I.JPG", displayPages: 96 },
    { title: "El diablo de la botella", pages: 14, priceAnillado: 2000, color: false, imgSrc: "img/el diablo de la botella .jpeg", displayPages: 28 },
    { title: "Los arboles mueren de pie", pages: 51, priceAnillado: 2000, color: false, imgSrc: "img/Los arboles mueres de pie.PNG", displayPages: 102 },
    { title: "La chica pajaro", pages: 38, priceAnillado: 2000, color: false, imgSrc: "img/La chica pajaro.bmp", displayPages: 150 },
    { title: "Mafalda 1", pages: 32, priceAnillado: 2000, color: false, imgSrc: "img/portada mafalda.PNG", displayPages: 128 },
    { title: "Biologia 2 santillana", pages: 87, priceAnillado: 2000, color: true, imgSrc: "img/BIologia 2 portada.jpg", displayPages: 174 },
    { title: "Construccion ciudadania 1 Santillana", pages: 65, priceAnillado: 2000, color: true, imgSrc: "img/cdc 1.jpg", displayPages: 130 },
    { title: "Construccion ciudadania 2 Santillana", pages: 71, priceAnillado: 2000, color: true, imgSrc: "img/ciudadania 2.jpeg", displayPages: 142 },
    { title: "Construccion ciudadania 3 Santillana", pages: 72, priceAnillado: 2000, color: true, imgSrc: "img/CIUDADANIA 3 PORTADA.jpg", displayPages: 144 },
    { title: "Historia 2 Santillana", pages: 104, priceAnillado: 2000, color: true, imgSrc: "img/portada historia 2¬∞.PNG", displayPages: 208 },
    { title: "Historia 2 Mandioca", pages: 118, priceAnillado: 2000, color: true, imgSrc: "img/portada historia 2¬∞ Mandioca.PNG", displayPages: 236 },
    { title: "Historia 1 Mandioca", pages: 79, priceAnillado: 2000, color: true, imgSrc: "img/Portada Historia 1Mandioca COLOR.bmp", displayPages: 158 },
    { title: "Mitos clasificados 2", pages: 24, priceAnillado: 2000, color: false, imgSrc: "img/Mitos clasificados  2 tapa.jpg", displayPages: 47 },
    ];

    document.addEventListener('DOMContentLoaded', () => {
        const catalogContainer = document.querySelector('.catalog');
        const cartItemsList = document.getElementById('cart-items');
        const cartTotalDisplay = document.getElementById('cart-total');
        const checkoutMpButton = document.getElementById('checkout-mp-button');
        const checkoutWaButton = document.getElementById('checkout-wa-button');
        const searchInput = document.getElementById('search-input');
        const mpDetailsContainer = document.getElementById('mp-details-container');
        const notification = document.getElementById('notification');
        const confirmSaleBtn = document.getElementById('confirm-sale-btn');
        const toggleStatsBtn = document.getElementById('toggle-stats-btn');
        const statsContainer = document.getElementById('stats-container');
        const statsYearFilter = document.getElementById('stats-year-filter');
        const statsMonthFilter = document.getElementById('stats-month-filter');
        let cart = [];

        function renderBooks(books) {
            catalogContainer.innerHTML = '';
            books.forEach(book => {
                const bookElement = document.createElement('div');
                bookElement.classList.add('book');
                bookElement.dataset.title = book.title;
                bookElement.dataset.pages = book.pages;
                bookElement.dataset.priceAnillado = book.priceAnillado;
                bookElement.dataset.color = book.color;
                const hasColor = book.color;
                const colorDisabled = hasColor ? '' : 'disabled';
                const colorLabelText = hasColor ? 'Color' : 'No disponible a color';
                const colorLabelStyle = hasColor ? '' : 'style="color: gray;"';
                const uniqueId = book.title.replace(/\s/g, '-');
                bookElement.innerHTML = `
                    <img src="${book.imgSrc}" alt="Portada de ${book.title}" class="book-img">
                    <h3 class="book-title">${book.title}</h3>
                    <p class="book-pages">${book.displayPages} p√°ginas</p>
                    <p class="book-price"></p>
                    <div class="book-format">
                        <input type="radio" id="color-${uniqueId}" name="format-${uniqueId}" value="color" ${colorDisabled}>
                        <label for="color-${uniqueId}" class="color-label" ${colorLabelStyle}>${colorLabelText}</label>
                        <input type="radio" id="bw-${uniqueId}" name="format-${uniqueId}" value="bw" checked>
                        <label for="bw-${uniqueId}">B/N</label>
                    </div>
                    <div class="book-binding">
                        <input type="checkbox" id="anillado-${uniqueId}" class="anillado-checkbox">
                        <label for="anillado-${uniqueId}">Anillado (+$${book.priceAnillado})</label>
                    </div>
                    <button class="add-to-cart-btn">Agregar al carrito</button>
                `;
                catalogContainer.appendChild(bookElement);
            });
            attachEventListeners();
        }

        booksData.sort((a, b) => a.title.localeCompare(b.title));
        renderBooks(booksData);

        function numeroALetras(num) {
            const unidades = ['', 'uno', 'dos', 'tres', 'cuatro', 'cinco', 'seis', 'siete', 'ocho', 'nueve'];
            const decenas = ['', 'diez', 'veinte', 'treinta', 'cuarenta', 'cincuenta', 'sesenta', 'setenta', 'ochenta', 'noventa'];
            const centenas = ['', 'ciento', 'doscientos', 'trescientos', 'cuatrocientos', 'quinientos', 'seiscientos', 'setecientos', 'ochocientos', 'novecientos'];
            function getDecenas(n) { if (n < 10) return unidades[n]; if (n === 10) return 'diez'; if (n < 20) return ['once', 'doce', 'trece', 'catorce', 'quince', 'diecis√©is', 'diecisiete', 'dieciocho', 'diecinueve'][n - 11]; if (n < 30) return 'veinti' + (n === 20 ? 'e' : unidades[n % 10]); const decena = decenas[Math.floor(n / 10)]; const unidad = n % 10; return decena + (unidad > 0 ? ' y ' + unidades[unidad] : ''); }
            function getCentenas(n) { if (n < 100) return getDecenas(n); if (n === 100) return 'cien'; return centenas[Math.floor(n / 100)] + (n % 100 > 0 ? ' ' + getDecenas(n % 100) : ''); }
            function getMiles(n) { if (n < 1000) return getCentenas(n); const miles = (Math.floor(n / 1000) === 1) ? 'mil' : getCentenas(Math.floor(n / 1000)) + ' mil'; return miles + (n % 1000 > 0 ? ' ' + getCentenas(n % 1000) : ''); }
            const integerPart = Math.floor(num); if (integerPart === 0) return 'Cero'; let letras = getMiles(integerPart); return letras.charAt(0).toUpperCase() + letras.slice(1);
        }

        function updateCartDisplay() {
            cartItemsList.innerHTML = '';
            let total = 0;
            cart.forEach(item => {
                const subtotal = item.price * item.quantity;
                const li = document.createElement('li');
                li.innerHTML = `<span>${item.quantity} x ${item.title} (${item.format}) - $${subtotal.toFixed(2)}</span><button class="remove-btn" data-id="${item.id}">Eliminar</button>`;
                cartItemsList.appendChild(li);
                total += subtotal;
            });
            const totalEnLetras = numeroALetras(total);
            cartTotalDisplay.innerHTML = `Total: $${total.toFixed(2)} <br> <span style="font-size: 0.8em; color: #555;">(${totalEnLetras} pesos)</span>`;
        }

        function updateBookPrice(bookElement) {
            const pages = parseFloat(bookElement.dataset.pages);
            const priceElement = bookElement.querySelector('.book-price');
            const formatInput = bookElement.querySelector('input[value="bw"]');
            const anilladoCheckbox = bookElement.querySelector('.anillado-checkbox');
            const anilladoPrice = parseFloat(bookElement.dataset.priceAnillado);
            let basePrice;
            const imageElement = bookElement.querySelector('.book-img');
            const isBw = formatInput.checked;
            if (isBw) { basePrice = pages * 70; imageElement.classList.add('bw-filter'); } else { basePrice = pages * 250; imageElement.classList.remove('bw-filter'); }
            if (anilladoCheckbox.checked) { basePrice += anilladoPrice; }
            priceElement.textContent = `$${basePrice.toFixed(2)}`;
        }

        function showNotification(message) {
            notification.textContent = message;
            notification.classList.add('show');
            setTimeout(() => { notification.classList.remove('show'); }, 3000);
        }

        function attachEventListeners() {
            document.querySelectorAll('.add-to-cart-btn').forEach(button => {
                button.addEventListener('click', () => {
                    const bookElement = button.closest('.book');
                    const title = bookElement.dataset.title;
                    const pages = parseFloat(bookElement.dataset.pages);
                    const selectedFormat = bookElement.querySelector('input[name^="format-"]:checked').value;
                    let unitPrice;
                    let baseFormatText;
                    if (selectedFormat === 'bw') { unitPrice = pages * 70; baseFormatText = 'Blanco y Negro'; } else { unitPrice = pages * 250; baseFormatText = 'Color'; }
                    const anilladoCheckbox = bookElement.querySelector('.anillado-checkbox');
                    const anilladoPrice = parseFloat(bookElement.dataset.priceAnillado);
                    let finalFormat = anilladoCheckbox.checked ? `${baseFormatText}, Anillado` : `${baseFormatText}, Abrochado`;
                    if (anilladoCheckbox.checked) { unitPrice += anilladoPrice; }
                    const itemId = `${title}-${finalFormat}`;
                    const existingItem = cart.find(item => item.id === itemId);
                    if (existingItem) { existingItem.quantity++; } else { cart.push({ id: itemId, title, price: unitPrice, format: finalFormat, quantity: 1 }); }
                    updateCartDisplay();
                    showNotification('¬°Agregado al carrito!');
                });
            });
            document.querySelectorAll('.book').forEach(book => {
                updateBookPrice(book);
                book.querySelectorAll('input[type="radio"], input[type="checkbox"]').forEach(input => {
                    input.addEventListener('change', () => updateBookPrice(book));
                });
            });
        }

        cartItemsList.addEventListener('click', (event) => {
            if (event.target.classList.contains('remove-btn')) {
                const idToRemove = event.target.dataset.id;
                const itemToRemove = cart.find(item => item.id === idToRemove);
                if (itemToRemove) {
                    if (itemToRemove.quantity > 1) { itemToRemove.quantity--; } else { const index = cart.findIndex(item => item.id === idToRemove); if (index !== -1) { cart.splice(index, 1); } }
                    updateCartDisplay();
                }
            }
        });

        checkoutMpButton.addEventListener('click', () => {
            if (mpDetailsContainer.style.display === 'block') { mpDetailsContainer.style.display = 'none'; checkoutWaButton.style.display = 'flex'; } else {
                const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                mpDetailsContainer.innerHTML = `<h4>Datos para el pago con Mercado Pago</h4><p><strong>Titular de la cuenta:</strong> Lucas Benjamin Mancuello Morel</p><p><strong>CUIT/CUIL:</strong> 20392843974</p><p><strong>CVU:</strong> 0000003100026593826739</p><p><strong>Alias:</strong> mancux2mp</p><p><strong>Total a pagar:</strong> $${total.toFixed(2)}</p><p>¬°Gracias por tu compra!</p>`;
                mpDetailsContainer.style.display = 'block'; checkoutWaButton.style.display = 'none';
            }
        });

        checkoutWaButton.addEventListener('click', () => {
            if (cart.length > 0) {
                const whatsappNumber = "5491131760731";
                let message = "¬°Hola! Quisiera comprar los siguientes cuadernillos:\n\n";
                cart.forEach(item => { const subtotal = item.price * item.quantity; message += `- ${item.quantity} x ${item.title} (${item.format}) - $${subtotal.toFixed(2)}\n`; });
                const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                const totalEnLetras = numeroALetras(total);
                message += `\nTotal: $${total.toFixed(2)} (${totalEnLetras} pesos)`;
                window.open(`https://wa.me/${whatsappNumber}?text=${encodeURIComponent(message)}`, '_blank');
            } else { alert("El carrito est√° vac√≠o. Por favor, agrega libros antes de enviar el pedido."); }
        });

        searchInput.addEventListener('keyup', (event) => { const searchTerm = event.target.value.toLowerCase(); const filteredBooks = booksData.filter(book => book.title.toLowerCase().includes(searchTerm)); renderBooks(filteredBooks); });
        
        const toggleThemeBtn = document.getElementById('toggle-theme-btn');
        const body = document.body;
        const applyTheme = (theme) => { if (theme === 'dark') { body.classList.add('dark-mode'); toggleThemeBtn.textContent = 'Modo Claro'; } else { body.classList.remove('dark-mode'); toggleThemeBtn.textContent = 'Modo Oscuro'; } };
        const currentTheme = localStorage.getItem('theme');
        if (currentTheme) { applyTheme(currentTheme); } else if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) { applyTheme('dark'); } else { applyTheme('light'); }
        toggleThemeBtn.addEventListener('click', () => { const newTheme = body.classList.contains('dark-mode') ? 'light' : 'dark'; localStorage.setItem('theme', newTheme); applyTheme(newTheme); });
        const backToTopBtn = document.getElementById('back-to-top-btn');
        window.addEventListener('scroll', () => { backToTopBtn.style.display = (window.scrollY > 300) ? 'block' : 'none'; });
        backToTopBtn.addEventListener('click', () => { window.scrollTo({ top: 0, behavior: 'smooth' }); });
        
        // --- INICIO: L√ìGICA DE ESTAD√çSTICAS CON FIREBASE (MODULAR) ---
        const monthNames = ["Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"];
        const salesCollection = collection(db, 'sales');

        async function populateYearSelector() {
            statsYearFilter.innerHTML = '<option value="all">Todos los a√±os</option>';
            try {
                const salesSnapshot = await getDocs(salesCollection);
                const years = new Set();
                salesSnapshot.forEach(doc => {
                    years.add(doc.data().year);
                });
                const sortedYears = Array.from(years).sort((a, b) => b - a);
                sortedYears.forEach(year => {
                    statsYearFilter.innerHTML += `<option value="${year}">${year}</option>`;
                });
                await populateMonthSelector(statsYearFilter.value);
            } catch (error) {
                console.error("Error al obtener a√±os: ", error);
                statsContainer.innerHTML = "<p>Error al cargar las estad√≠sticas.</p>";
            }
        }

        async function populateMonthSelector(selectedYear) {
            statsMonthFilter.innerHTML = '<option value="all">Todos los meses</option>';
            statsMonthFilter.disabled = true;

            if (selectedYear !== 'all') {
                try {
                    const q = query(salesCollection, where('year', '==', parseInt(selectedYear)));
                    const salesSnapshot = await getDocs(q);
                    const months = new Set();
                    salesSnapshot.forEach(doc => {
                        months.add(doc.data().month);
                    });
                    const sortedMonths = Array.from(months).sort((a, b) => a - b);
                    sortedMonths.forEach(month => {
                        statsMonthFilter.innerHTML += `<option value="${month}">${monthNames[month - 1]}</option>`;
                    });
                    statsMonthFilter.disabled = false;
                } catch (error) {
                    console.error("Error al obtener meses: ", error);
                }
            }
        }

        async function updateStatsDisplay(selectedYear, selectedMonth) {
            statsContainer.innerHTML = "<p>Cargando estad√≠sticas...</p>";
            
            let queries = [];
            if (selectedYear !== 'all') {
                queries.push(where('year', '==', parseInt(selectedYear)));
            }
            if (selectedMonth !== 'all') {
                queries.push(where('month', '==', parseInt(selectedMonth)));
            }
            const finalQuery = query(salesCollection, ...queries);

            try {
                const salesSnapshot = await getDocs(finalQuery);
                if (salesSnapshot.empty) {
                    statsContainer.innerHTML = "<p>No hay ventas registradas para la selecci√≥n actual.</p>";
                    return;
                }

                const statsForDisplay = {};
                salesSnapshot.forEach(doc => {
                    const sale = doc.data();
                    statsForDisplay[sale.title] = (statsForDisplay[sale.title] || 0) + sale.quantity;
                });
                
                const sortedStats = Object.entries(statsForDisplay).sort(([,a],[,b]) => b - a);
                let statsHtml = `<p>Mostrando ventas:</p><ol>`;
                sortedStats.forEach(([title, count]) => {
                    statsHtml += `<li><strong>${title}</strong>: ${count} vendido(s)</li>`;
                });
                statsHtml += '</ol>';
                statsContainer.innerHTML = statsHtml;

            } catch (error) {
                console.error("Error al mostrar estad√≠sticas: ", error);
                statsContainer.innerHTML = "<p>Error al cargar las estad√≠sticas. Revisa la consola para m√°s detalles.</p>";
            }
        }

        confirmSaleBtn.addEventListener('click', async () => {
            if (cart.length === 0) {
                alert('El carrito est√° vac√≠o. Agrega productos para confirmar una venta.');
                return;
            }

            confirmSaleBtn.disabled = true;
            const now = new Date();
            const currentYear = now.getFullYear();
            const currentMonth = now.getMonth() + 1;

            const batch = writeBatch(db);
            cart.forEach(item => {
                const saleRef = doc(salesCollection);
                batch.set(saleRef, {
                    title: item.title,
                    format: item.format,
                    quantity: item.quantity,
                    price: item.price,
                    timestamp: serverTimestamp(),
                    year: currentYear,
                    month: currentMonth
                });
            });

            try {
                await batch.commit();
                cart = [];
                updateCartDisplay();
                await populateYearSelector();
                showNotification('¬°Venta registrada con √©xito en la nube!');
                if (statsContainer.style.display === 'block') {
                    await updateStatsDisplay(statsYearFilter.value, statsMonthFilter.value);
                }
            } catch (error) {
                console.error("Error al guardar la venta: ", error);
                showNotification('Error al registrar la venta.');
            } finally {
                confirmSaleBtn.disabled = false;
            }
        });

        toggleStatsBtn.addEventListener('click', async () => {
            const isVisible = statsContainer.style.display === 'block';
            if (isVisible) {
                statsContainer.style.display = 'none';
                toggleStatsBtn.textContent = 'Mostrar Estad√≠sticas';
            } else {
                statsContainer.style.display = 'block';
                toggleStatsBtn.textContent = 'Ocultar Estad√≠sticas';
                await updateStatsDisplay(statsYearFilter.value, statsMonthFilter.value);
            }
        });
        
        statsYearFilter.addEventListener('change', async () => {
             const selectedYear = statsYearFilter.value;
             await populateMonthSelector(selectedYear);
             if (statsContainer.style.display === 'block') {
                await updateStatsDisplay(selectedYear, statsMonthFilter.value);
             }
        });

        statsMonthFilter.addEventListener('change', async () => {
             if (statsContainer.style.display === 'block') {
                await updateStatsDisplay(statsYearFilter.value, statsMonthFilter.value);
             }
        });
        
        populateYearSelector();
        // --- FIN: L√ìGICA DE ESTAD√çSTICAS CON FIREBASE (MODULAR) ---
    });
</script>
</body>
</html>